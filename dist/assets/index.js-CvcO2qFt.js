import{e as s}from"./vault-OFHbTrfE.js";const o=new Set;chrome.runtime.onMessage.addListener((e,n,r)=>{if(e.action==="ACTIVATE_AEGIS"){const t=e.tabId;d(t),r({status:"attempting_attach"})}return!0});function d(e){o.has(e)||chrome.debugger.attach({tabId:e},"1.3",()=>{if(chrome.runtime.lastError){console.error("[Aegis] Attach failed:",chrome.runtime.lastError.message);return}o.add(e),chrome.debugger.sendCommand({tabId:e},"Network.enable"),chrome.action.setBadgeText({tabId:e,text:"REC"}),chrome.action.setBadgeBackgroundColor({tabId:e,color:"#ef4444"}),console.log(`[Aegis] Secure Tunnel Established on Tab ${e}`)})}chrome.debugger.onEvent.addListener(async(e,n,r)=>{if(n==="Network.webSocketFrameReceived"){const t=r.response.payloadData,c=e.tabId;if(!t||t.length<5)return;try{const a=await chrome.tabs.get(c);await s(t,a.url,c)}catch(a){console.error("[Aegis] Capture Error:",a)}}});chrome.debugger.onDetach.addListener(e=>{o.delete(e.tabId),chrome.action.setBadgeText({tabId:e.tabId,text:""})});
